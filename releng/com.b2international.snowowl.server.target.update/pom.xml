<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>
	<artifactId>com.b2international.snowowl.server.target.update</artifactId>
	<packaging>eclipse-repository</packaging>
	
	<parent>
		<groupId>com.b2international.snowowl</groupId>
		<artifactId>releng-parent</artifactId>
		<version>6.4.0-SNAPSHOT</version>
	</parent>

	<properties>
		<repository.name>target_platform_${project.version}</repository.name>
	</properties>
	
	<build>
		<plugins>
			<plugin>
				<groupId>org.eclipse.tycho</groupId>
				<artifactId>target-platform-configuration</artifactId>
				<version>${tycho.version}</version>
				<configuration combine.self="override">
					<resolver>p2</resolver>
					<pomDependencies>consider</pomDependencies>
					<filters>
						<filter>
							<type>osgi-bundle</type>
							<id>com.google.guava</id>
							<restrictTo>
								<versionRange>${guava.version}</versionRange>
							</restrictTo>
						</filter>
						<!-- Restricted Logging API and implementation to version of Virgo 3.7.x -->
						<filter>
							<type>p2-installable-unit</type>
							<id>org.slf4j.api</id>
							<restrictTo>
								<versionRange>${slf4j.version}</versionRange>
							</restrictTo>
						</filter>
						<filter>
							<type>p2-installable-unit</type>
							<id>ch.qos.logback.classic</id>
							<restrictTo>
								<versionRange>${logback.version}</versionRange>
							</restrictTo>
						</filter>
						<filter>
							<type>p2-installable-unit</type>
							<id>ch.qos.logback.core</id>
							<restrictTo>
								<versionRange>${logback.version}</versionRange>
							</restrictTo>
						</filter>
						<filter>
							<type>p2-installable-unit</type>
							<id>ch.qos.logback.slf4j</id>
							<restrictTo>
								<versionRange>${logback.version}</versionRange>
							</restrictTo>
						</filter>
						<!-- Restrict Jackson bundles to the selected version -->
						<filter>
							<type>p2-installable-unit</type>
							<id>com.fasterxml.jackson.core.jackson-annotations</id>
							<restrictTo>
								<version>${jackson.version}</version>
							</restrictTo>
						</filter>
						<filter>
							<type>p2-installable-unit</type>
							<id>com.fasterxml.jackson.core.jackson-core</id>
							<restrictTo>
								<version>${jackson.version}</version>
							</restrictTo>
						</filter>
						<filter>
							<type>p2-installable-unit</type>
							<id>com.fasterxml.jackson.core.jackson-databind</id>
							<restrictTo>
								<version>${jackson.version}</version>
							</restrictTo>
						</filter>
						<filter>
							<type>p2-installable-unit</type>
							<id>com.fasterxml.jackson.dataformat.jackson-dataformat-yaml</id>
							<restrictTo>
								<version>${jackson.version}</version>
							</restrictTo>
						</filter>
						<filter>
							<type>p2-installable-unit</type>
							<id>com.fasterxml.jackson.dataformat.jackson-dataformat-cbor</id>
							<restrictTo>
								<version>${jackson.version}</version>
							</restrictTo>
						</filter>
						<filter>
							<type>p2-installable-unit</type>
							<id>com.fasterxml.jackson.dataformat.jackson-dataformat-csv</id>
							<restrictTo>
								<version>${jackson.version}</version>
							</restrictTo>
						</filter>
						<filter>
							<type>p2-installable-unit</type>
							<id>com.fasterxml.jackson.dataformat.jackson-dataformat-afterburner</id>
							<restrictTo>
								<version>${jackson.version}</version>
							</restrictTo>
						</filter>
						<!-- Restrict Apache Commons Collections to versions above and including 3.2.2 -->
						<filter>
							<type>p2-installable-unit</type>
							<id>org.apache.commons.collections</id>
							<restrictTo>
								<versionRange>${commons.collections.version}</versionRange>
							</restrictTo>
						</filter>
					</filters>
					<environments>
						<environment>
							<os>macosx</os>
							<ws>cocoa</ws>
							<arch>x86_64</arch>
						</environment>
						<environment>
							<os>win32</os>
							<ws>win32</ws>
							<arch>x86_64</arch>
						</environment>
						<environment>
							<os>linux</os>
							<ws>gtk</ws>
							<arch>x86_64</arch>
						</environment>
					</environments>
				</configuration>
			</plugin>
			<plugin>
				<groupId>org.eclipse.tycho</groupId>
				<artifactId>tycho-p2-repository-plugin</artifactId>
				<executions>
					<execution>
						<id>default-assemble-repository</id>
						<phase>package</phase>
						<goals>
							<goal>assemble-repository</goal>
						</goals>
						<configuration>
							<includeAllDependencies>true</includeAllDependencies>
						</configuration>
					</execution>
				</executions>
			</plugin>
			<plugin>
				<groupId>org.eclipse.tycho.extras</groupId>
				<artifactId>tycho-eclipserun-plugin</artifactId>
				<version>${tycho-extras.version}</version>
				<configuration>
					<argLine>-Declipse.p2.mirrors=false</argLine>
					<appArgLine>-nosplash -consoleLog -application org.eclipse.equinox.p2.repository.repo2runnable -source ${project.build.directory}/repository -destination ${project.build.directory}/${repository.name}</appArgLine>
					<dependencies>
	                    <dependency>
	                        <artifactId>org.eclipse.equinox.p2.transport.ecf</artifactId>
	                        <type>eclipse-plugin</type>
	                    </dependency>
	                    <dependency>
	                        <artifactId>org.eclipse.equinox.p2.repository</artifactId>
	                        <type>eclipse-plugin</type>
	                    </dependency>
	                    <dependency>
	                        <artifactId>org.eclipse.equinox.p2.touchpoint.natives</artifactId>
	                        <type>eclipse-plugin</type>
	                    </dependency>
	                    <dependency>
	                        <artifactId>org.eclipse.equinox.p2.touchpoint.eclipse</artifactId>
	                        <type>eclipse-plugin</type>
	                    </dependency>
	                    <dependency>
	                        <artifactId>org.eclipse.equinox.p2.artifact.repository</artifactId>
	                        <type>eclipse-plugin</type>
	                    </dependency>
	                    <dependency>
	                        <artifactId>org.eclipse.equinox.p2.repository.tools</artifactId>
	                        <type>eclipse-plugin</type>
	                    </dependency>
	                    <dependency>
	                        <artifactId>org.eclipse.equinox.ds</artifactId>
	                        <type>eclipse-plugin</type>
	                    </dependency>
			    		<dependency>
							<artifactId>org.eclipse.core.net</artifactId>
							<type>eclipse-plugin</type>
		    			</dependency>
                	</dependencies>
                	<repositories>
                		<repository>
							<id>kepler</id>
							<url>http://download.eclipse.org/releases/kepler</url>
							<layout>p2</layout>
						</repository>
                	</repositories>
				</configuration>
				<executions>
					<execution>
						<id>assemble-target-platform</id>
						<phase>integration-test</phase>
						<goals>
							<goal>eclipse-run</goal>
						</goals>
					</execution>
				</executions>
			</plugin>
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-assembly-plugin</artifactId>
				<executions>
					<execution>
						<id>package-runnable-target</id>
						<phase>integration-test</phase>
						<goals>
							<goal>single</goal>
						</goals>
						<configuration>
							<descriptor>${basedir}/assembly/runnable.xml</descriptor>
						</configuration>
					</execution>
				</executions>
			</plugin>
		</plugins>
	</build>
	
</project>