
= Configuration reference

Snow Owl Server comes with a predefined default configuration file, which can be used to tweak various system parameters.
The configuration file is in YAML format, and located at `/opt/snowowl-{edition}_{version}/snowowl_config.yml`. You
can read more about how to create/write such files here: http://en.wikipedia.org/wiki/YAML.

The configuration file has a hierarchical structure, which is defined by modules. Different modules can have different
configurations, a module is defined by its name, which should start a line in the file. Configuration parameters in a
module should be indented by two spaces following the module's name.

The next section contains the reference of our currently supported configuration parameters. Each parameter should be
present in a module configuration as described above.

Snow Owl Server refuses to start if the configuration file contains syntactical or structural errors. The cause of the
problem can be found in the `log.log` file, or in the console if you've redirected the output of the server's startup
process.

== Authentication

[cols="3*", options="header"]
|===
|Name
|Default
|Description

|type
|`LDAP`
|`PROP_FILE`, `LDAP` - choose which type of authentication method you want.
|===

--------------------------
authentication:
  type: PROP_FILE
--------------------------

== Repository

[cols="3*", options="header"]
|===
|Name
|Default
|Description

|host
|`0.0.0.0`
|The host name to bind to.

|port
|`2036`
|The port of the chosen network interface to use when listening for connections.

|numberOfWorkers
|`3 x NumberOfCores`
|The number of worker threads to assign to a repository during initialization.

|revisionCache
|`true`
|Enable CDO revision cache to keep data returned from the database.

|readerPoolCapacity
|`7`
|The capacity of the reader pool associated with the SNOMED CT store.

|writerPoolCapacity
|`3`
|The capacity of the writer pool associated with the SNOMED CT store.
|===

--------------------------
repository:
  host: 0.0.0.0
  port: 2036
--------------------------

== Database

[cols="3*", options="header"]
|===
|Name
|Default
|Description

|directory
|`store`
|The directory of the embedded database inside the global resources folder where the application should look for the database files by default (if no location parameter is given).

|type
|`h2`
|The type of the database adapter to use when connecting to the database.

|driverClass
|`org.h2.Driver`
|The fully qualified name of the driver's Java class to use when connecting to the database.

|datasourceClass
|`org.h2.jdbcx.JdbcDataSource`
|The fully qualified name of the datasource's Java class to use when connecting to the database.

|scheme
|`jdbc:h2:`
|The scheme to use when connecting to the database.

|location
|
|The location of the database when connecting to it. If not set then in embedded mode the default directory parameter will be used as location.

|username
|
|The username of the database user to use when connecting to the database.

|password
|
|The password of the database user to use when connecting to the database.

|settings
|
|Other database specific JDBC settings to use when connecting to the database.
|===

--------------------------
repository:
  database:
    directory: store
    type: h2
    username: admin
    password: admin
--------------------------

== Index

[cols="3*", options="header"]
|===
|Name
|Default
|Description

|commitInterval
|`15000`
|The hard commit interval of an index in milliseconds.

|translogSyncInterval
|`5000`
|The sync interval of the transaction log in milliseconds.

|queryWarnThreshold
|`400`
|The threshold of the warn log when querying data.

|queryInfoThreshold
|`300`
|The threshold of the info log when querying data.

|queryDebugThreshold
|`100`
|The threshold of the debug log when querying data.

|queryTraceThreshold
|`50`
|The threshold of the trace log when querying data.

|fetchWarnThreshold
|`200`
|The threshold of the warn log when fetching data.

|fetchInfoThreshold
|`100`
|The threshold of the info log when fetching data.

|fetchDebugThreshold
|`50`
|The threshold of the debug log when fetching data.

|fetchTraceThreshold
|`10`
|The threshold of the trace log when fetching data.
|===

--------------------------
repository:
  index:
    commitInterval: 5000
    translogSyncInterval: 1000
    queryWarnThreshold: 400
    fetchInfoThreshold: 100
--------------------------

== RPC

RPC is a custom protocol implementation used to solve request-response based communication between a client and a server.

NOTE: Changing these settings is not recommended and currently unsupported in production environments.

[cols="3*", options="header"]
|===
|Name
|Default
|Description

|logging
|`false`
|`true`, `false`, `ON`, `OFF` - enable or disable verbose logging during RPC communication
|===

--------------------------
rpc:
  logging: true
--------------------------

== Metrics

Snow Owl can measure and report execution times (and other metrics in the future) of executed requests.

[cols="3*", options="header"]
|===
|Name
|Default
|Description

|enabled
|`true`
|`true`, `false`, `ON`, `OFF` - enable or disable metrics in the application
|===

== SNOMED CT

Configuration of SNOMED CT terminology services.

[cols="3*", options="header"]
|===
|Name
|Default
|Description

|readerPoolCapacity
|`7`
|The capacity of the reader pool associated with the SNOMED CT store.

|writerPoolCapacity
|`3`
|The capacity of the writer pool associated with the SNOMED CT store.

|language
|`en-gb`
|`en-gb`, `en-us`, `en-sg` - The language code to use for SNOMED CT Descriptions. Descriptions with membership of the chosen
language's reference set will be used runtime.

|maxReasonerCount
|`2`
|The maximum number of reasoners permitted to do computation simultaneously. Minimum `1`, maximum `3` is allowed. If the value is set to
`1`, classification requests will be processed in a sequential fashion.

|maxReasonerResults
|`10`
|The number of inferred taxonomies that should be kept in memory after the reasoner completes the computational stage. The user can only 
choose to save the results of the classification run if the corresponding taxonomy instance is still present.

|maxReasonerRuns
|`1000`
|The number of classification runs of which details should be preserved on disk. Details include inferred and redundant relationships, 
the list of equivalent concepts found during classification, and classification run metadata (start and end times, status, requesting user, 
reasoner used for this run).

|showReasonerUsageWarning
|`true`
|'true' will display a dialog if any user selects a non-ELK reasoner, citing memory and compatibility problems, also recommending to contact B2i.

|concreteDomainSupport
|`false`
|'true' will turn on support for concrete domains.

|inferredEditingEnabled
|`false`
|'true' will enable manual editing of inferred relationships and concrete domain elements.
|===

--------------------------
snomed:
  language: en-gb
  maxReasonerCount: 1
  maxReasonerResults: 20
  showReasonerUsageWarning: true
  concreteDomainSupport: true
  inferredEditingEnabled: false
--------------------------

== SNOMED CT Component Identifier Configuration

Snow Owl's SNOMED CT identifier service can be configured to be either using the built-in service or SNOMED International's external Component Identifier Service (CIS). The configuration needs to be placed within the *snomed/ids* section.
If omitted, then default configuration will be used, which is the built-in (embedded) service based on the index store allocating ids in a sequential fashion.

[cols="3*", options="header"]
|===
|Name
|Default
|Description

|service
|EMBEDDED 
|`EMBEDDED` or `CIS` - The service used to generate ids.

|source
|INDEX
|`INDEX` or `MEMORY` - The source of the generated ids.  `MEMORY` is used for testing.

|strategy
|SEQUENTIAL
|`SEQUENTIAL` or `RANDOM` - The strategy of the id generation.

|cisBaseUrl
|
|The service's URL with port and without context root.

|cisContextRoot
|
|The context root of the id generation service.

|cisUserName
|
|The registered user name at the CIS site.

|cisPassword
|
|The password for the registered user name at the CIS site.

|cisClientSoftwareKey
|Snow Owl
|The client software key to be persisted within CIS as reference.

|cisNumberOfPollTries
|1
|The maximum number of tries when polling jobs of bulk requests.

|cisTimeBetweenPollTries
|1000
|The time to wait between 2 job polling actions It is in milliseconds.

|cisNumberOfReauthTries
|2
|The maximum number of re-authentication attempts when a 401 Not authorized response is received.

|cisMaxConnections
|100
|Maximum number of simultaneous connections that Snow Owl can make to the CIS host via HTTP.

|maxIdGenerationAttempts
|1000
|Maximum number of attempts any non-CIS ID generator will take to generate a single SNOMED CT identifier, if exceeded it throws an exception.
|===

Example for using the built-in service with random ids using the index as the source:

--------------------------
snomed:
  ...
  ids:
    service: EMBEDDED
    source: INDEX
    strategy : RANDOM
    cisBaseUrl : <cis_host_and_port>
    cisContextRoot : api
    cisUserName : <your-cis-username>
    cisPassword : <your-cis-password>
    cisClientSoftwareKey : Snow Owl dev. deployment
    cisNumberOfPollTries : 1
    cisTimeBetweenPollTries : 1000
    cisMaxConnections: 100
  ...
--------------------------


Example for using IHTSDO's external CIS service:

--------------------------
snomed:
  ...
  ids:
    service : CIS
    cisBaseUrl : <cis_host_and_port>
    cisContextRoot : api
    cisUserName : <your-cis-username>
    cisPassword : <your-cis-password>
    cisClientSoftwareKey : Snow Owl dev. deployment
    cisNumberOfPollTries : 1
    cisTimeBetweenPollTries : 1000
    cisMaxConnections: 100
  ...
--------------------------
